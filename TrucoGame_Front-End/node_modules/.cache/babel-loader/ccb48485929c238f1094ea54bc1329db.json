{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\acapo\\\\Desktop\\\\Programacion Avanzada\\\\Proyecto final - Truco\\\\CardGame_Front-End\\\\src\\\\Game\\\\Game.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport { Alert, Col, Container, Row, Button } from \"react-bootstrap\";\nimport { useLocation } from \"react-router-dom\";\nimport { errorHandler } from \"../helpers/errorHandler\";\nimport GameBoard from \"./GameBoard\";\nimport GameErrorModal from \"./GameErrorModal\";\nimport { endGame, getGame } from \"./gameService\";\nimport PointsCounter from \"./PointsCounter\";\nimport request from \"axios\";\nimport { GameContext } from \"../context/GameContext\";\nimport { getCurrentUser } from \"../User/userService\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function Game() {\n  _s();\n\n  const location = useLocation();\n  const [gameData, setGameData] = useState(location.state);\n  const [requestError, setRequestError] = useState(undefined);\n  const currentPlayer = gameData.game.players.find(player => {\n    var _getCurrentUser;\n\n    return player.user.username == ((_getCurrentUser = getCurrentUser()) === null || _getCurrentUser === void 0 ? void 0 : _getCurrentUser.username);\n  });\n  useEffect(() => {\n    const interval = setInterval(() => {\n      refreshGame();\n    }, 1000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const refreshGame = async () => {\n    if (gameData.game.state != \"finished\") {\n      try {\n        let gameNumber = localStorage.getItem(\"game\");\n\n        if (gameNumber != null) {\n          const res = await getGame(gameNumber);\n\n          if (res.status != 200) {\n            setRequestError(errorHandler(res));\n          } else {\n            const data = res.data;\n            setGameData(data);\n            console.log(gameData);\n          }\n        } else {// error\n        }\n      } catch (error) {\n        if (request.isAxiosError(error)) {\n          setRequestError(error.message);\n        }\n      }\n    }\n  };\n\n  const handleEndGame = () => async event => {\n    try {\n      const res = await endGame(gameData.game.number);\n\n      if (res.status != 200) {\n        setRequestError(errorHandler(res));\n      } else {\n        const data = res.data;\n        setGameData(data);\n      }\n    } catch (error) {\n      if (request.isAxiosError(error)) {\n        setRequestError(error.message);\n      }\n    }\n  };\n\n  function checkWinner() {\n    if (gameData.game.points_us > gameData.game.points_them) {\n      return \"El equipo ganador es \\\"nosotros\\\"\";\n    } else {\n      if (gameData.game.points_us < gameData.game.points_them) {\n        return \"El equipo ganador es \\\"ellos\\\"\";\n      } else {\n        return \"El resultado es un empate\";\n      }\n    }\n  }\n\n  function checkStatus(status) {\n    switch (status) {\n      case \"waiting\":\n        return /*#__PURE__*/_jsxDEV(Alert, {\n          variant: \"secondary\",\n          className: \"my-5 text-center\",\n          children: \"Faltan juadores para que comienze la partida\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 25\n        }, this);\n\n      case \"started\":\n        return /*#__PURE__*/_jsxDEV(Row, {\n          children: [/*#__PURE__*/_jsxDEV(Col, {\n            xs: \"10\",\n            children: /*#__PURE__*/_jsxDEV(GameBoard, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Col, {\n            xs: \"2\",\n            children: /*#__PURE__*/_jsxDEV(PointsCounter, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 97,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 21\n        }, this);\n\n      default:\n        return /*#__PURE__*/_jsxDEV(Alert, {\n          variant: \"secondary\",\n          className: \"my-5 text-center\",\n          children: checkWinner()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 25\n        }, this);\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(GameContext.Provider, {\n    value: {\n      gameData,\n      requestError,\n      setGameData,\n      setRequestError\n    },\n    children: /*#__PURE__*/_jsxDEV(Container, {\n      className: \"mt-5 pt-4 flex-container \",\n      children: [/*#__PURE__*/_jsxDEV(Row, {\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          xs: {\n            span: 4,\n            offset: 4\n          },\n          children: /*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-center\",\n            children: gameData.game.number\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 21\n        }, this), (currentPlayer === null || currentPlayer === void 0 ? void 0 : currentPlayer.role) == \"admin\" ? /*#__PURE__*/_jsxDEV(Col, {\n          xs: {\n            span: 2,\n            offset: 2\n          },\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"danger\",\n            className: \"btn-block\",\n            onClick: handleEndGame(),\n            children: \"Terminar Partida\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 21\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(GameErrorModal, {\n        errorMessage: requestError,\n        setErrorMessage: setRequestError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 17\n      }, this), checkStatus(gameData.game.state)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Game, \"OFAbJo8MVsFtTw5EPzfdxS37z0I=\", false, function () {\n  return [useLocation];\n});\n\n_c = Game;\n\nvar _c;\n\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["useEffect","useState","Alert","Col","Container","Row","Button","useLocation","errorHandler","GameBoard","GameErrorModal","endGame","getGame","PointsCounter","request","GameContext","getCurrentUser","Game","location","gameData","setGameData","state","requestError","setRequestError","undefined","currentPlayer","game","players","find","player","user","username","interval","setInterval","refreshGame","clearInterval","gameNumber","localStorage","getItem","res","status","data","console","log","error","isAxiosError","message","handleEndGame","event","number","checkWinner","points_us","points_them","checkStatus","span","offset","role"],"sources":["C:/Users/acapo/Desktop/Programacion Avanzada/Proyecto final - Truco/CardGame_Front-End/src/Game/Game.tsx"],"sourcesContent":["import { useEffect, useState, useContext, createContext } from \"react\";\r\nimport { Alert, Col, Container, Row, Button, Modal } from \"react-bootstrap\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport { errorHandler } from \"../helpers/errorHandler\";\r\nimport GameBoard from \"./GameBoard\";\r\nimport GameErrorModal from \"./GameErrorModal\";\r\nimport { Data, endGame, GameData, getGame, Player } from \"./gameService\";\r\nimport PointsCounter from \"./PointsCounter\";\r\nimport request from \"axios\"\r\nimport { GameContext } from \"../context/GameContext\";\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faXmark } from \"@fortawesome/free-solid-svg-icons\"\r\nimport { getCurrentUser } from \"../User/userService\";\r\n\r\n\r\n\r\nexport default function Game() {\r\n    const location = useLocation();\r\n    const [gameData, setGameData] = useState(location.state as GameData)\r\n    const [requestError, setRequestError] = useState<string | undefined>(undefined)\r\n    const currentPlayer:Player | undefined = gameData.game.players.find(player => player.user.username == getCurrentUser()?.username)\r\n\r\n    useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            refreshGame();\r\n        }, 1000);\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    const refreshGame = async () => {\r\n        if(gameData.game.state != \"finished\"){\r\n            try {\r\n                let gameNumber = localStorage.getItem(\"game\")\r\n\r\n                if (gameNumber != null) {\r\n                    const res = await getGame(gameNumber)\r\n\r\n                    if (res.status != 200) {\r\n                        setRequestError(errorHandler(res));\r\n                    } else {\r\n                        const data = res.data as GameData\r\n                        setGameData(data)\r\n                        console.log(gameData);\r\n                    }\r\n\r\n                } else {\r\n                    // error\r\n                }\r\n            } catch (error: unknown) {\r\n                if (request.isAxiosError(error)) {\r\n                    setRequestError(error.message)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    const handleEndGame = () => async (event: any) => {\r\n        try{                                            \r\n            const res = await endGame(gameData.game.number)\r\n            if (res.status != 200) {\r\n                setRequestError(errorHandler(res));\r\n            } else {\r\n                const data = res.data as GameData\r\n                setGameData(data)                    \r\n            }                                \r\n        }catch (error: unknown) {\r\n            if (request.isAxiosError(error)) {\r\n                setRequestError(error.message)\r\n            }\r\n        }\r\n    }\r\n\r\n    function checkWinner(){\r\n        if(gameData.game.points_us > gameData.game.points_them){\r\n            return \"El equipo ganador es \\\"nosotros\\\"\"\r\n        }else{  \r\n            if(gameData.game.points_us < gameData.game.points_them){\r\n                return \"El equipo ganador es \\\"ellos\\\"\"            \r\n            }else{\r\n                return \"El resultado es un empate\"\r\n            }            \r\n        }\r\n\r\n    }\r\n\r\n    function checkStatus(status: string) {\r\n        switch (status) {\r\n            case \"waiting\":\r\n                return (<Alert variant=\"secondary\" className=\"my-5 text-center\">Faltan juadores para que comienze la partida</Alert>)\r\n            case \"started\":\r\n                return (\r\n                    <Row>\r\n                        <Col xs=\"10\">\r\n                            <GameBoard />\r\n                        </Col>\r\n                        <Col xs=\"2\">\r\n                            <PointsCounter />\r\n                        </Col>\r\n                    </Row>\r\n                )\r\n            default:\r\n                return (<Alert variant=\"secondary\" className=\"my-5 text-center\">{checkWinner()}</Alert>)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <GameContext.Provider value={{ gameData, requestError,setGameData, setRequestError }}>\r\n            <Container className=\"mt-5 pt-4 flex-container \">\r\n                <Row>\r\n                    <Col xs={{ span: 4, offset: 4 }}>\r\n                        <h2 className=\"text-center\">{gameData.game.number}</h2>\r\n                    </Col>\r\n                    {currentPlayer?.role == \"admin\" ?\r\n                    <Col xs={{ span: 2, offset: 2 }}>\r\n                        <Button variant=\"danger\" className=\"btn-block\" onClick={(handleEndGame())}>Terminar Partida</Button>\r\n                    </Col> : <></>}\r\n                </Row>                \r\n\r\n                <GameErrorModal errorMessage={requestError} setErrorMessage={setRequestError}/>\r\n\r\n                {checkStatus(gameData.game.state)}\r\n            </Container>\r\n        </GameContext.Provider>\r\n    )\r\n}"],"mappings":";;;AAAA,SAASA,SAAT,EAAoBC,QAApB,QAA+D,OAA/D;AACA,SAASC,KAAT,EAAgBC,GAAhB,EAAqBC,SAArB,EAAgCC,GAAhC,EAAqCC,MAArC,QAA0D,iBAA1D;AACA,SAASC,WAAT,QAA4B,kBAA5B;AACA,SAASC,YAAT,QAA6B,yBAA7B;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,SAAeC,OAAf,EAAkCC,OAAlC,QAAyD,eAAzD;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,OAAP,MAAoB,OAApB;AACA,SAASC,WAAT,QAA4B,wBAA5B;AAGA,SAASC,cAAT,QAA+B,qBAA/B;;;AAIA,eAAe,SAASC,IAAT,GAAgB;EAAA;;EAC3B,MAAMC,QAAQ,GAAGX,WAAW,EAA5B;EACA,MAAM,CAACY,QAAD,EAAWC,WAAX,IAA0BnB,QAAQ,CAACiB,QAAQ,CAACG,KAAV,CAAxC;EACA,MAAM,CAACC,YAAD,EAAeC,eAAf,IAAkCtB,QAAQ,CAAqBuB,SAArB,CAAhD;EACA,MAAMC,aAAgC,GAAGN,QAAQ,CAACO,IAAT,CAAcC,OAAd,CAAsBC,IAAtB,CAA2BC,MAAM;IAAA;;IAAA,OAAIA,MAAM,CAACC,IAAP,CAAYC,QAAZ,wBAAwBf,cAAc,EAAtC,oDAAwB,gBAAkBe,QAA1C,CAAJ;EAAA,CAAjC,CAAzC;EAEA/B,SAAS,CAAC,MAAM;IACZ,MAAMgC,QAAQ,GAAGC,WAAW,CAAC,MAAM;MAC/BC,WAAW;IACd,CAF2B,EAEzB,IAFyB,CAA5B;IAGA,OAAO,MAAMC,aAAa,CAACH,QAAD,CAA1B;EACH,CALQ,EAKN,EALM,CAAT;;EAOA,MAAME,WAAW,GAAG,YAAY;IAC5B,IAAGf,QAAQ,CAACO,IAAT,CAAcL,KAAd,IAAuB,UAA1B,EAAqC;MACjC,IAAI;QACA,IAAIe,UAAU,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAjB;;QAEA,IAAIF,UAAU,IAAI,IAAlB,EAAwB;UACpB,MAAMG,GAAG,GAAG,MAAM3B,OAAO,CAACwB,UAAD,CAAzB;;UAEA,IAAIG,GAAG,CAACC,MAAJ,IAAc,GAAlB,EAAuB;YACnBjB,eAAe,CAACf,YAAY,CAAC+B,GAAD,CAAb,CAAf;UACH,CAFD,MAEO;YACH,MAAME,IAAI,GAAGF,GAAG,CAACE,IAAjB;YACArB,WAAW,CAACqB,IAAD,CAAX;YACAC,OAAO,CAACC,GAAR,CAAYxB,QAAZ;UACH;QAEJ,CAXD,MAWO,CACH;QACH;MACJ,CAjBD,CAiBE,OAAOyB,KAAP,EAAuB;QACrB,IAAI9B,OAAO,CAAC+B,YAAR,CAAqBD,KAArB,CAAJ,EAAiC;UAC7BrB,eAAe,CAACqB,KAAK,CAACE,OAAP,CAAf;QACH;MACJ;IACJ;EACJ,CAzBD;;EA2BA,MAAMC,aAAa,GAAG,MAAM,MAAOC,KAAP,IAAsB;IAC9C,IAAG;MACC,MAAMT,GAAG,GAAG,MAAM5B,OAAO,CAACQ,QAAQ,CAACO,IAAT,CAAcuB,MAAf,CAAzB;;MACA,IAAIV,GAAG,CAACC,MAAJ,IAAc,GAAlB,EAAuB;QACnBjB,eAAe,CAACf,YAAY,CAAC+B,GAAD,CAAb,CAAf;MACH,CAFD,MAEO;QACH,MAAME,IAAI,GAAGF,GAAG,CAACE,IAAjB;QACArB,WAAW,CAACqB,IAAD,CAAX;MACH;IACJ,CARD,CAQC,OAAOG,KAAP,EAAuB;MACpB,IAAI9B,OAAO,CAAC+B,YAAR,CAAqBD,KAArB,CAAJ,EAAiC;QAC7BrB,eAAe,CAACqB,KAAK,CAACE,OAAP,CAAf;MACH;IACJ;EACJ,CAdD;;EAgBA,SAASI,WAAT,GAAsB;IAClB,IAAG/B,QAAQ,CAACO,IAAT,CAAcyB,SAAd,GAA0BhC,QAAQ,CAACO,IAAT,CAAc0B,WAA3C,EAAuD;MACnD,OAAO,mCAAP;IACH,CAFD,MAEK;MACD,IAAGjC,QAAQ,CAACO,IAAT,CAAcyB,SAAd,GAA0BhC,QAAQ,CAACO,IAAT,CAAc0B,WAA3C,EAAuD;QACnD,OAAO,gCAAP;MACH,CAFD,MAEK;QACD,OAAO,2BAAP;MACH;IACJ;EAEJ;;EAED,SAASC,WAAT,CAAqBb,MAArB,EAAqC;IACjC,QAAQA,MAAR;MACI,KAAK,SAAL;QACI,oBAAQ,QAAC,KAAD;UAAO,OAAO,EAAC,WAAf;UAA2B,SAAS,EAAC,kBAArC;UAAA;QAAA;UAAA;UAAA;UAAA;QAAA,QAAR;;MACJ,KAAK,SAAL;QACI,oBACI,QAAC,GAAD;UAAA,wBACI,QAAC,GAAD;YAAK,EAAE,EAAC,IAAR;YAAA,uBACI,QAAC,SAAD;cAAA;cAAA;cAAA;YAAA;UADJ;YAAA;YAAA;YAAA;UAAA,QADJ,eAII,QAAC,GAAD;YAAK,EAAE,EAAC,GAAR;YAAA,uBACI,QAAC,aAAD;cAAA;cAAA;cAAA;YAAA;UADJ;YAAA;YAAA;YAAA;UAAA,QAJJ;QAAA;UAAA;UAAA;UAAA;QAAA,QADJ;;MAUJ;QACI,oBAAQ,QAAC,KAAD;UAAO,OAAO,EAAC,WAAf;UAA2B,SAAS,EAAC,kBAArC;UAAA,UAAyDU,WAAW;QAApE;UAAA;UAAA;UAAA;QAAA,QAAR;IAfR;EAiBH;;EAED,oBACI,QAAC,WAAD,CAAa,QAAb;IAAsB,KAAK,EAAE;MAAE/B,QAAF;MAAYG,YAAZ;MAAyBF,WAAzB;MAAsCG;IAAtC,CAA7B;IAAA,uBACI,QAAC,SAAD;MAAW,SAAS,EAAC,2BAArB;MAAA,wBACI,QAAC,GAAD;QAAA,wBACI,QAAC,GAAD;UAAK,EAAE,EAAE;YAAE+B,IAAI,EAAE,CAAR;YAAWC,MAAM,EAAE;UAAnB,CAAT;UAAA,uBACI;YAAI,SAAS,EAAC,aAAd;YAAA,UAA6BpC,QAAQ,CAACO,IAAT,CAAcuB;UAA3C;YAAA;YAAA;YAAA;UAAA;QADJ;UAAA;UAAA;UAAA;QAAA,QADJ,EAIK,CAAAxB,aAAa,SAAb,IAAAA,aAAa,WAAb,YAAAA,aAAa,CAAE+B,IAAf,KAAuB,OAAvB,gBACD,QAAC,GAAD;UAAK,EAAE,EAAE;YAAEF,IAAI,EAAE,CAAR;YAAWC,MAAM,EAAE;UAAnB,CAAT;UAAA,uBACI,QAAC,MAAD;YAAQ,OAAO,EAAC,QAAhB;YAAyB,SAAS,EAAC,WAAnC;YAA+C,OAAO,EAAGR,aAAa,EAAtE;YAAA;UAAA;YAAA;YAAA;YAAA;UAAA;QADJ;UAAA;UAAA;UAAA;QAAA,QADC,gBAGQ,qCAPb;MAAA;QAAA;QAAA;QAAA;MAAA,QADJ,eAWI,QAAC,cAAD;QAAgB,YAAY,EAAEzB,YAA9B;QAA4C,eAAe,EAAEC;MAA7D;QAAA;QAAA;QAAA;MAAA,QAXJ,EAaK8B,WAAW,CAAClC,QAAQ,CAACO,IAAT,CAAcL,KAAf,CAbhB;IAAA;MAAA;MAAA;MAAA;IAAA;EADJ;IAAA;IAAA;IAAA;EAAA,QADJ;AAmBH;;GA5GuBJ,I;UACHV,W;;;KADGU,I"},"metadata":{},"sourceType":"module"}